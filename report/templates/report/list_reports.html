{% extends "main.html" %}

{% block title %}
Rapports
{% endblock %}

{% load static %} 
<link rel="stylesheet" href="{% static 'css/select.css' %}">
<script src="alert/dist/sweetalert.min.js"></script>
<link rel="stylesheet" href="alert/dist/sweetalert.css">
{% block activeListReport %} {% include 'active_bar.html' %} {% endblock %}
{% block content %}

<div class="row mb-3" style="margin-top: 30px;"> 
    <form method="GET" style="{% if page %}margin: 30px 0px;{% else %}margin-top: 13%;{% endif %}">
        {% csrf_token %}
        <div class="row height d-flex justify-content-center align-items-center">
            <div class="col-md-6">
                <div class="form" style="position: relative;">
                    <i class="fa fa-search" style="position: absolute; top:12px; left: 17px; color: white;"></i>{{ filter.form.search }}
                </div>
            </div>
            <div class="col-md-2" style="width: 12%;">
                {{ filter.form.start_date }}
            </div>
            <div class="col-md-2" style="width: 12%;">
                {{ filter.form.end_date }}
            </div>
            <div class="col-md-2" style="width: 10%;">
                {{ filter.form.line }}
            </div>
            <div class="col-md-1" style="width: 7%;">
                <input type="number" class="form-control" value="{% if request.GET.page_size %}{{ request.GET.page_size }}{% else %}12{% endif %}" style="background-color: rgba(202, 207, 215, 0.5); 
                border-color: transparent; box-shadow: 0 0 6px rgba(0, 0, 0, 0.2); color: #f2f2f2; height: 40px;" name="page_size">
            </div>
            <div class="col-md-1">
                <button type="submit" class="btn btn-secondary btn-block customSaveButton" style="height: 40px;">Appliquer</button>
            </div>
        </div>
    </form>
    {% if page %}
    <div class="sectionList">
        <table class="table table-borderless">
            <thead style="border-bottom: 2px solid white;">
                <tr class="text-white">
                  <th>N° BL</th>
                  <th>Créateur</th>
                  <th>Départ</th>
                  <th>Déstination</th>
                  <th>Date départ</th>
                  <th>Fournisseur</th>
                  <th>Tonnage</th>
                  <th>Prix</th>
                  <th>Chauffeur</th>
                  <th>État</th>
                  <th style="width: 20vh;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for report in page %}
                <tr style="color: #dde3f0;">
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.n_bl }}</td>
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.creator }}</td>
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.prix.depart }}</td>
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.prix.destination }}</td>
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.date_dep|date:"d/m/Y" }}</td>
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.prix.fournisseur }}</td>
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.prix.tonnage }}</td>
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.prix.price }}</td>
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.chauffeur }}</td>
                    <td onclick="window.location='{% url 'view_report' report.id %}'" style="cursor: pointer;">{{ report.state }}</td>
                    <td style="vertical-align: middle;">
                        <button type="button" {% if report.state != 'Brouillon' or report.creator != user %} disabled {% endif %} onclick="window.location='{% url 'edit_report' report.id %}'" class="btn"><i class="fas fa-edit" style="color: white;"></i></button>
                        <button type="button" {% if report.state != 'Brouillon' or report.creator != user %} disabled {% endif %} onclick="confirmReportDel('{{report.id|escapejs}}', '{{report.n_bl|escapejs}}')" class="btn"><i class="far fa-trash-alt" style="color: white;"></i></button>
                    </td>
                </tr>
                 {% endfor %}
            </tbody>
        </table>
        {% if page.has_other_pages %}
            {% include 'pagination.html' %}
        {% endif %}    
    </div>
    {% else %}
        {% include 'empty_list.html' %}
    {% endif %}
</div>
<style>
    select option {
        background: rgba(127, 139, 161, 0.9);
    }
</style>

<script>
    const confirmReportDel = (reportID, reportNBL) => {
        swal({ 
        title: `Confirmation de la suppression.`,   
        text: `Etes-vous sûr que vous voulez supprimer le rapport avec N° BL = ${reportNBL}?`,   
        type: "warning",
        showCancelButton: true,   
        confirmButtonColor: "#DD6B55",   
        confirmButtonText: "Oui",   
        cancelButtonText: "Non",   
        closeOnConfirm: true,   
        closeOnCancel: true },
        function(isConfirm){   
            if (isConfirm){
              window.location.href = "{% url 'delete_report' 123456789 %}".replace(/123456789/, reportID);
            }});
    };
</script>
{% endblock %}
